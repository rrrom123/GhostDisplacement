
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>FinalGiantOPTwo</title><meta name="generator" content="MATLAB 9.9"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2021-03-22"><meta name="DC.source" content="FinalGiantOPTwo.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput">clear


<span class="comment">%************************SET THE PARAMETERS********************************</span>


<span class="comment">%Mean thermal background, this is n|r|^2</span>

Bckg = 2.91;

<span class="comment">%Efficiency of the detector Eta</span>

Eta = 0.3;

<span class="comment">%Weak reflectivity R</span>

Ref = 0.1;

<span class="comment">% first BS reflectivity,|r|^2, GHOST DISPLACEMENT</span>

rsq = 0.1;

<span class="comment">%first BS reflectivity,|r|^2, CONDITIONING</span>

rsqC = 0.64;

<span class="comment">%Coherent amplitude, |Beta|, GHOST DISPLACEMENT</span>

B = 10;

<span class="comment">%Number of Trials</span>

Trials = 1:1e03;


<span class="comment">%**************************************************************************</span>


<span class="comment">%------------------ DO NOT CHANGE BELOW THIS LINE--------------------------</span>


<span class="comment">%Weak transmissivity |T|^2</span>

BigTsq = 1 - Ref^2;

<span class="comment">%Thermal probability of no click</span>

NoClickT  = 1/(Eta*Bckg +1);

<span class="comment">%Prob of a click when only TB is present</span>

ClickT = 1 - NoClickT;


<span class="comment">%****************************EXPERIMENT************************************</span>

<span class="comment">%null hypothesis,Prob. of object being there</span>

P1 = 0.5;

P0 = 1-P1;

<span class="comment">%**************************************************************************</span>
<span class="comment">%---------------------------CONDITIONING-----------------------------------</span>
<span class="comment">% *************************************************************************</span>


<span class="comment">% First BS, transmissivity |t|^2</span>

tsqC = 1 - rsqC;

<span class="comment">% mean INPUT photon number</span>

nC = Bckg./rsqC;

<span class="comment">% mean OUTPUT photon number</span>

mC =Bckg/(nC*tsqC*Eta+1);

<span class="comment">% Prob. of No Click\ Prob. of Success at the bottom detector</span>

PNot = 1/(1+nC*tsqC*Eta);

PSucc = 1 - PNot;

<span class="comment">% No Click probability when WRO is present</span>

NoClickWROCon = (1/(1-PNot))*(1/(nC*rsqC*Eta+1)-<span class="keyword">...</span>
    PNot/(nC*rsqC*BigTsq*Eta + mC*(Ref^2)*Eta + 1));

<span class="comment">% Click probability of the WRO when conditioning</span>

ClickWROCon = 1 - NoClickWROCon;



<span class="comment">%--------------------------------------------------------------------------</span>


<span class="comment">% Initialising vectors storing the clicks</span>

ClickYesCon = zeros(1,length(Trials));
ClickNoCon = zeros(1,length(Trials));
ClickFailedCon = zeros(1,length(Trials));

isClickingCon = true;
tempYesCon = P1;
tempNoCon = P0;


<span class="comment">%--------------------------------------------------------------------------</span>

<span class="keyword">for</span> i=Trials

    R1C = rand; <span class="comment">% controlling bottom measurement</span>

 <span class="keyword">if</span> R1C &lt; PSucc <span class="comment">% If we successfully measured at the bottom detector</span>

     R2C = rand ;<span class="comment">% controlling top measurement</span>

     <span class="keyword">if</span> R2C &lt; ClickWROCon  <span class="comment">% If the top detector clicked</span>

        isClickingCon = true;

        <span class="comment">%Bayes prob. of object being there, given a click</span>

        PObjYes = (ClickWROCon*P1)./(ClickWROCon*P1+ClickT*P0);

        P1 = PObjYes;
        P0 = 1-P1;

        tempYesCon = P1;

        ClickYesCon(i)= P1;
        ClickNoCon(i) = 0;
        ClickFailedCon(i) = 0;

     <span class="keyword">else</span> <span class="comment">% If the top detector didn't click</span>

        isClickingCon = false;

        <span class="comment">%Bayes prob. of object being there, given no click</span>

        PObjNo=(NoClickWROCon*P1)./(NoClickWROCon*P1+NoClickT*P0);

        P1=PObjNo;
        P0=1-P1;
        tempNoCon = P1;
        ClickNoCon(i)=P1;
        ClickYesCon(i)=0;
        ClickFailedCon(i) =0;

     <span class="keyword">end</span>

 <span class="keyword">else</span>

     <span class="keyword">if</span> i==1

         ClickFailedCon(1)=0.5;
         ClickYesCon(1) = 0;
         ClickNoCon(1) = 0;

     <span class="keyword">else</span>

         ClickYesCon(i) = 0;
         ClickNoCon(i) = 0;

         <span class="keyword">if</span> isClickingCon == true

             ClickFailedCon(i)= tempYesCon;

         <span class="keyword">else</span>

             ClickFailedCon(i)= tempNoCon;

         <span class="keyword">end</span>

     <span class="keyword">end</span>

 <span class="keyword">end</span>


<span class="keyword">end</span>


HitsCon = ClickYesCon + ClickNoCon + ClickFailedCon;

<span class="comment">%^^^^^^^^^^^^^^^^^^^^^^STUFF FOR PLOTS^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

BG = <span class="string">'$n|r|^{2}= $'</span>+ string(Bckg)+<span class="string">', '</span>;
BETA = <span class="string">'$|\beta|= $'</span>+ string(B)+ <span class="string">', '</span>;
ETA = <span class="string">'$\eta = $ '</span>+string(Eta)+ <span class="string">', '</span>;
RSQ = <span class="string">'$|R|^2 = $ '</span>+string(Ref^2);
TITLE = BG + BETA +ETA + RSQ;

<span class="comment">%^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

plot(Trials,HitsCon,<span class="string">'.'</span>,<span class="string">'MarkerSize'</span>,10,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'k'</span>)
title([<span class="string">'Prob. of WRO hiding (OBJECT PRESENT) ,'</span><span class="keyword">...</span>
   TITLE],<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>)

xlabel(<span class="string">'Trial number'</span>)
ylabel(<span class="string">'Probability'</span>)


<span class="comment">%--------------------------------------------------------------------------</span>


hold <span class="string">on</span>


<span class="comment">% *************************************************************************</span>
<span class="comment">% %----------------------GHOST DISPLACEMENT--------------------------------</span>
<span class="comment">% *************************************************************************</span>


<span class="comment">% Resetting the hypotheses</span>

P0 = 0.5;

P1 = 0.5;

<span class="comment">% First BS transmissivity, |t|^2</span>

tsq = 1 - rsq;

<span class="comment">% Mean INPUT photon number</span>

nG = Bckg./rsq;

<span class="comment">% Mean OUTPUT photon number,</span>

m = Bckg/(nG*tsq*Eta+1);

<span class="comment">% Displacement amplitude</span>

delsq =  rsq*tsq*(B^2)*(nG^2)*(Eta^2)/(nG*tsq*Eta + 1);

<span class="comment">% Probability of measuring in |alpha&gt;&lt;alpha|</span>

Aprob = exp(-(B^2)*Eta/(1 + nG*tsq*Eta))/(1 + nG*tsq*Eta);

<span class="comment">% No Click probability when WRO is present</span>

NoClickWRO = exp(-delsq*(Ref^2)*Eta/(1+nG*rsq*BigTsq*Eta+ m*(Ref^2)*Eta))<span class="keyword">...</span>
    /(1 + nG*rsq*BigTsq*Eta + m*(Ref^2)*Eta);

<span class="comment">% Click probability of the WRO</span>

ClickWRO = 1 - NoClickWRO;

<span class="comment">% Difference between thermal background and a displaced</span>

DGD = ClickWRO - ClickT;

Dcon = ClickWROCon - ClickT;

<span class="comment">%--------------------------------------------------------------------------</span>


<span class="comment">% Initialising vectors storing the clicks</span>

ClickYes = zeros(1,length(Trials));
ClickNo = zeros(1,length(Trials));
ClickFailed =zeros(1,length(Trials));
isClicking = true;

tempYes = P1;
tempNo = P0;


<span class="comment">%--------------------------------------------------------------------------</span>

<span class="keyword">for</span> i = Trials

    R1G = rand; <span class="comment">% vector of randoms controlling |alpha&gt; measurements</span>

 <span class="keyword">if</span> R1G &lt; Aprob <span class="comment">% If we successfully measured in |alpha&gt;</span>

     R2G = rand; <span class="comment">% random, controlling top measurement</span>

     <span class="keyword">if</span> R2G &lt; ClickWRO <span class="comment">% If the top detector clicked</span>

        isClicking = true;

        <span class="comment">%Bayes prob. of object being there, given a click</span>

        PObjYes = (ClickWRO*P1)./(ClickWRO*P1+ClickT*P0);

        P1 = PObjYes;
        P0 = 1-P1;
        tempYes = P1;
        ClickYes(i)= P1;
        ClickNo(i)= 0;
        ClickFailed(i) = 0;

     <span class="keyword">else</span> <span class="comment">% If the top detector didn't click</span>

        isClicking = false;

        <span class="comment">%Bayes prob. of object being there, given no click</span>

        PObjNo =(NoClickWRO*P1)./(NoClickWRO*P1+NoClickT*P0);

        P1 = PObjNo;
        P0 = 1-P1;
        tempNo = P1;
        ClickNo(i)= P1;
        ClickYes(i) = 0;
        ClickFailed(i) = 0;

     <span class="keyword">end</span>

 <span class="keyword">else</span>

     <span class="keyword">if</span> i==1

         ClickFailed(1) = 0.5;
         ClickYes(1) = 0;
         ClickNo(1) = 0;

     <span class="keyword">else</span>

         ClickYes(i) = 0;
         ClickNo(i) = 0;

         <span class="keyword">if</span> isClicking == true

             ClickFailed(i) = tempYes;

         <span class="keyword">else</span>

             ClickFailed(i) = tempNo;

         <span class="keyword">end</span>

     <span class="keyword">end</span>

 <span class="keyword">end</span>


<span class="keyword">end</span>

Hits = ClickYes + ClickNo + ClickFailed;

plot(Trials,Hits,<span class="string">'.'</span>,<span class="string">'MarkerSize'</span>,10,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'green'</span>)
lgd = legend(<span class="string">'Conditioning'</span> ,<span class="string">'Ghost Displacement'</span>,<span class="string">'Interpreter'</span>,<span class="string">'latex'</span>);
lgd.FontSize = 18;
hold <span class="string">off</span>

DD = DGD - Dcon;
</pre><img vspace="5" hspace="5" src="FinalGiantOPTwo_01.png" alt=""> <p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2020b</a><br></p></div><!--
##### SOURCE BEGIN #####
clear 


%************************SET THE PARAMETERS********************************


%Mean thermal background, this is n|r|^2

Bckg = 2.91; 

%Efficiency of the detector Eta

Eta = 0.3;

%Weak reflectivity R

Ref = 0.1;

% first BS reflectivity,|r|^2, GHOST DISPLACEMENT

rsq = 0.1;

%first BS reflectivity,|r|^2, CONDITIONING

rsqC = 0.64;

%Coherent amplitude, |Beta|, GHOST DISPLACEMENT

B = 10;

%Number of Trials

Trials = 1:1e03;


%**************************************************************************


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH DO NOT CHANGE BELOW THIS LINEREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH


%Weak transmissivity |T|^2

BigTsq = 1 - Ref^2;

%Thermal probability of no click

NoClickT  = 1/(Eta*Bckg +1);

%Prob of a click when only TB is present

ClickT = 1 - NoClickT;


%****************************EXPERIMENT************************************

%null hypothesis,Prob. of object being there

P1 = 0.5;

P0 = 1-P1;

%**************************************************************************
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-CONDITIONINGREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
% *************************************************************************


% First BS, transmissivity |t|^2

tsqC = 1 - rsqC;

% mean INPUT photon number

nC = Bckg./rsqC;

% mean OUTPUT photon number

mC =Bckg/(nC*tsqC*Eta+1);

% Prob. of No Click\ Prob. of Success at the bottom detector

PNot = 1/(1+nC*tsqC*Eta);

PSucc = 1 - PNot;

% No Click probability when WRO is present

NoClickWROCon = (1/(1-PNot))*(1/(nC*rsqC*Eta+1)-...
    PNot/(nC*rsqC*BigTsq*Eta + mC*(Ref^2)*Eta + 1));

% Click probability of the WRO when conditioning

ClickWROCon = 1 - NoClickWROCon;



%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH


% Initialising vectors storing the clicks

ClickYesCon = zeros(1,length(Trials));
ClickNoCon = zeros(1,length(Trials));
ClickFailedCon = zeros(1,length(Trials));

isClickingCon = true;
tempYesCon = P1;
tempNoCon = P0;


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

for i=Trials
    
    R1C = rand; % controlling bottom measurement

 if R1C < PSucc % If we successfully measured at the bottom detector
     
     R2C = rand ;% controlling top measurement
     
     if R2C < ClickWROCon  % If the top detector clicked
         
        isClickingCon = true;
        
        %Bayes prob. of object being there, given a click
        
        PObjYes = (ClickWROCon*P1)./(ClickWROCon*P1+ClickT*P0);
        
        P1 = PObjYes;
        P0 = 1-P1;
        
        tempYesCon = P1;
        
        ClickYesCon(i)= P1;
        ClickNoCon(i) = 0; 
        ClickFailedCon(i) = 0;
         
     else % If the top detector didn't click
         
        isClickingCon = false;
        
        %Bayes prob. of object being there, given no click
        
        PObjNo=(NoClickWROCon*P1)./(NoClickWROCon*P1+NoClickT*P0);
        
        P1=PObjNo;
        P0=1-P1;
        tempNoCon = P1;
        ClickNoCon(i)=P1;
        ClickYesCon(i)=0;
        ClickFailedCon(i) =0;
     
     end
     
 else
     
     if i==1
         
         ClickFailedCon(1)=0.5;
         ClickYesCon(1) = 0;
         ClickNoCon(1) = 0;
         
     else   
         
         ClickYesCon(i) = 0;
         ClickNoCon(i) = 0;
         
         if isClickingCon == true
             
             ClickFailedCon(i)= tempYesCon;
             
         else
             
             ClickFailedCon(i)= tempNoCon;
             
         end
         
     end
     
 end


end


HitsCon = ClickYesCon + ClickNoCon + ClickFailedCon;

%^^^^^^^^^^^^^^^^^^^^^^STUFF FOR PLOTS^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

BG = '$n|r|^{2}= $'+ string(Bckg)+', ';
BETA = '$|\beta|= $'+ string(B)+ ', ';
ETA = '$\eta = $ '+string(Eta)+ ', ';
RSQ = '$|R|^2 = $ '+string(Ref^2);
TITLE = BG + BETA +ETA + RSQ;

%^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

plot(Trials,HitsCon,'.','MarkerSize',10,'MarkerEdgeColor','k')
title(['Prob. of WRO hiding (OBJECT PRESENT) ,'...
   TITLE],'Interpreter','latex')

xlabel('Trial number')
ylabel('Probability')


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH


hold on

    
% *************************************************************************
% %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHGHOST DISPLACEMENTREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% *************************************************************************


% Resetting the hypotheses

P0 = 0.5;

P1 = 0.5;

% First BS transmissivity, |t|^2

tsq = 1 - rsq;

% Mean INPUT photon number

nG = Bckg./rsq;

% Mean OUTPUT photon number, 

m = Bckg/(nG*tsq*Eta+1);

% Displacement amplitude

delsq =  rsq*tsq*(B^2)*(nG^2)*(Eta^2)/(nG*tsq*Eta + 1);

% Probability of measuring in |alpha><alpha|

Aprob = exp(-(B^2)*Eta/(1 + nG*tsq*Eta))/(1 + nG*tsq*Eta);

% No Click probability when WRO is present

NoClickWRO = exp(-delsq*(Ref^2)*Eta/(1+nG*rsq*BigTsq*Eta+ m*(Ref^2)*Eta))...
    /(1 + nG*rsq*BigTsq*Eta + m*(Ref^2)*Eta); 

% Click probability of the WRO

ClickWRO = 1 - NoClickWRO;

% Difference between thermal background and a displaced 

DGD = ClickWRO - ClickT;

Dcon = ClickWROCon - ClickT;

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH


% Initialising vectors storing the clicks

ClickYes = zeros(1,length(Trials));
ClickNo = zeros(1,length(Trials));
ClickFailed =zeros(1,length(Trials));
isClicking = true;

tempYes = P1;
tempNo = P0;


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

for i = Trials
    
    R1G = rand; % vector of randoms controlling |alpha> measurements

 if R1G < Aprob % If we successfully measured in |alpha>
     
     R2G = rand; % random, controlling top measurement
     
     if R2G < ClickWRO % If the top detector clicked
         
        isClicking = true;
        
        %Bayes prob. of object being there, given a click
        
        PObjYes = (ClickWRO*P1)./(ClickWRO*P1+ClickT*P0);
        
        P1 = PObjYes;
        P0 = 1-P1;
        tempYes = P1;
        ClickYes(i)= P1;
        ClickNo(i)= 0; 
        ClickFailed(i) = 0;
         
     else % If the top detector didn't click
         
        isClicking = false;
        
        %Bayes prob. of object being there, given no click
        
        PObjNo =(NoClickWRO*P1)./(NoClickWRO*P1+NoClickT*P0);
        
        P1 = PObjNo;
        P0 = 1-P1;
        tempNo = P1;
        ClickNo(i)= P1;
        ClickYes(i) = 0;
        ClickFailed(i) = 0;
     
     end
     
 else
     
     if i==1
         
         ClickFailed(1) = 0.5;
         ClickYes(1) = 0;
         ClickNo(1) = 0;
         
     else   
         
         ClickYes(i) = 0;
         ClickNo(i) = 0;
         
         if isClicking == true
             
             ClickFailed(i) = tempYes;
             
         else
             
             ClickFailed(i) = tempNo;
             
         end
         
     end
     
 end


end

Hits = ClickYes + ClickNo + ClickFailed;
    
plot(Trials,Hits,'.','MarkerSize',10,'MarkerEdgeColor','green')
lgd = legend('Conditioning' ,'Ghost Displacement','Interpreter','latex');
lgd.FontSize = 18;
hold off

DD = DGD - Dcon;
##### SOURCE END #####
--></body></html>